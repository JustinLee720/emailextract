/*Copyright (c) 2022 ksoft http://www.dummysoftware.com*/function onInitialize(){importScripts(chrome.runtime.getURL("scripts/scrapeManager.js"),chrome.runtime.getURL("scripts/utility.js")),chrome.runtime.onInstalled.addListener(function(e){onInstallUpdate(e)}),chrome.tabs.onUpdated.addListener(function(e,a,t){onTabUpdated(t,a)}),chrome.runtime.onMessage.addListener(function(e,a,t){onMessage(e)})}function onInstallUpdate(e){const a=chrome.runtime.getManifest().version;"install"==e.reason?chrome.tabs.create({url:"https://www.dummysoftware.com/email-exporter/?action=install&new="+a}):"update"==e.reason&&e.previousVersion<2.1&&chrome.tabs.create({url:"https://www.dummysoftware.com/email-exporter/?action=update&old="+e.previousVersion+"&new="+a})}async function onTabUpdated(e,a){const t=await getOptions();if(t.auto&&"complete"===a.status){const a=await ScrapeManager.scrape(e,t.type);if(a){t.append?(t.data.url=a.url,t.data.data=a.date,t.data.emails=ScrapeManager.unique(t.data.emails.concat(a.emails)),t.data.phones=ScrapeManager.unique(t.data.phones.concat(a.phones))):t.data=a,await saveOptions(t);const e=`${t.data.emails.length}/${t.data.phones.length}`;chrome.action.setBadgeText({text:e})}}}function onMessage(e){"scrape"==e.action&&onTabUpdated(e.tab,{status:"complete"})}onInitialize();